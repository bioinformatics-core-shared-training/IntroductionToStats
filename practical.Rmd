---
title: "Introduction to Statistical Analysis"
author: "Mark Dunning, Rosemary Tate and Sarah Vowler"
date: '`r format(Sys.time(), "Last modified: %d %b %Y")`'
output:  pdf_document
toc: TRUE
---

```{r eval=TRUE, echo=F, results="asis"}
BiocStyle::markdown()
library("knitr")
opts_chunk$set(tidy=FALSE,dev="png",fig.show="as.is",
               fig.width=10,fig.height=4,
               message=FALSE,eval=FALSE,warning=FALSE,echo=FALSE)
```

# Introduction
In this practical, we will use several 'read-life' datasets to demonstrate some of the concepts you have seen in the lectures. We will guide you through how to analyse these datasets in Shiny and the kinds of questions you should be asking yourself when faced with similar data.

To answer the questions in this practical we will be using apps that we have developed using the [***Shiny***](http://shiny.rstudio.com/gallery/) add-on for the *R* statistical package. **R** is a freely-available open-source software that is popular within academic and commercial communities. The functionality within the software compares favourably with other statistical packages (SAS, SPSS and Stata). The downside is that **R** has a steep learning-curve and requires a basic familiarity with command-line software. To ease the transition we have chosen to present this course using a series of online tools that will allow you to perform statistical analysis without having to worry about learning R. At the same time, the R code required for the analysis will be recorded in the background. You will therefore be able to repeat the analysis at a later date, or pass-on to others. As you gain familiarity with R through other courses, you will see how the code generated by Shiny can be adapted to your own needs.

The datasets you will need for this practical should be [***downloaded and unzipped now***](https://rawgit.com/bioinformatics-core-shared-training/IntroductionToStats/master/CourseData.zip)


# T-tests practical

## The effect of disease on height
A scientist knows that the mean height of females in England is 165cm and wants to know whether her patients with disease X have heights that differ significantly from the population mean - we will use a one-sample t-test to test this. The data are contained in the file **`diseaseX.csv`** and can be analysed online at:-

[http://bioinformatics.cruk.cam.ac.uk/stats/OneSampleTest/](http://bioinformatics.cruk.cam.ac.uk/stats/OneSampleTest/)

a) What are your null and alternative hypotheses?

```{r}
cat("Null hypothesis: The mean height of female patients with disease X = 165cm 
      (the population mean for females)\n")
cat("Alternative hypothesis: The mean height of female patients with disease X != 165cm 
      (the population mean for females)\n")
```


To import the file `diseaseX.csv` into ***Shiny*** you will need to select the `Choose File` option and navigate to where the course data are located on your laptop. You can use the ***The data*** tab to check that the data has be imported correctly.


```{r}
myfile <- "Practical/diseaseX.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
```



b) A histogram of the `Height` variable will be automatically generate for you. To view it, click on the ***Data Distribution***

Do the data look normally distributed? Based on the histogram, is the one-sample t –test appropriate?

```{r}
datacol <-  2 
X <- data[,datacol]
colnames(data)[datacol] <- 'X'
library(ggplot2)
ggplot(data, aes(x=X)) + geom_histogram(aes(y=..density..),binwidth=.5,colour='black', fill='white')+ stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$X), sd=sd(data$X)))
```

```{r}
cat("In this case the data look normally distributed. Therefore, the one-sample t-test is appropriate.")
```



c) We are interested in knowing whether the mean height in our sample of patients with disease X is different from that of the general population. Perform a **one-sample t-test**

Remember to change the value of ***True mean***.

What is the mean height in your sample? What is your value of t? What is the p-value? How do you interpret the p-value?

```{r}
alternative <- 'two.sided'
mu <-  0 
t.test(X,mu=mu,alternative=alternative)
```

```{r}
cat("Mean height in sample = 171.1cm (95% CI: 169.3-172.9)
t = 7.23, 
df = 19,
p  <= 0.0001.

Under the null hypothesis, the probability of observing a t-statistic as extreme as 7.23, 
is very small P(t <= 7.23 | t >= 7.23) < 0.0001). Therefore, there is strong evidence 
to reject the null hypothesis in favour of the alternative hypothesis. There is strong evidence 
to suggest that the mean height in female patients with disease X is different to the 
population mean height of females of 165cm.")

```


## Biological processes duration

In the file **`bp_times.csv`**, we have the durations of a biological process for two samples of wild-type and knock-out cells (times in seconds). We are interested in seeing whether there is a difference in the durations for the two types of cells – we shall use an **independent t-test** to compare the two cell-types.

These data can be analysed online at [http://bioinformatics.cruk.cam.ac.uk/stats/TwoSampleTest/](http://bioinformatics.cruk.cam.ac.uk/stats/TwoSampleTest/)

a) What are your null and alternative hypotheses?

```{r}
cat("Null hypothesis: there is no difference in the duration of the 
biological process for the two cell types.

Alternative hypothesis: there is a difference in the duration of the 
biological process for the two cell types.")
```



Import the data using ***Choose File*** as before. Make sure that the ***1st column is a factor?*** checkbox is ticked.

b) Histograms to compare the two groups will be created for you automatically. Do the data look normally distributed for each cell-type? Is the independent t-test appropriate.


```{r}
myfile <- "Practical/bp_times.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
p
```

```{r}
cat("The data do appear to be approximately normally distributed as we could 
easily draw a bell shape over each of the two histograms. The independent t-test is appropriate")
```


c) Use the *Numerical statistics* analysis to compute descriptive statistics for each group. 

```{r}
lapply(split(data$value,data$variable),RcmdrMisc::numSummary)
with(data, RcmdrMisc::plotMeans(value,variable,error.bars="conf.int",level=0.95))
```


Given the distribution of your data, which statistics might you report to summarise your data? Look at and compare the 95\% confidence intervals of the mean durations of the two cell-types. Do they overlap?

```{r}
cat("The normality assumption seems reasonable so the mean and standard deviation 
(or standard error or 95% CI) provide a good summary of the data. 
If the data were skewed, the median and interquartile range would be more meaningful.  
The confidence intervals do not overlap.")
```


d) In order to apply the correct statistical test, we need to test to see if the variances of the two groups are comparable. This is tested for us automatically in the Shiny app. Click the ***Histogram*** tab to see the result.

What do you conclude from the p-value of this test. How does it influence what test to use?

```{r}
cat("The test yields a p-value of 0.03568, which is sufficient evidence 
    to reject the null hypothesis that the variances of the two groups are the same. 
    Therefore we should apply Welch's correction.")
```


e) Use the appropriate test to compare the durations of the two groups.

Is a Welch's correction needed? What is your value of t? What is the p-value? How do you interpret the p-value? Is this in agreement with the 95\% confidence intervals?

```{r}
alternative <- 'two.sided'
paired <- FALSE
var.equal <-FALSE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```

```{r}
cat("When we run the independent (unpaired) t test, a formal comparison of the variances 
between the two groups is automatically run. The corresponding p-value is 0.00125 which indicates 
evidence to reject the null hypothesis of equal variances between the two groups. 
Therefore, Welch's correction is needed. We can also look at the histograms and summary statistics 
to see whether we might need to use the Welch's correction. We can see that the standard deviation 
(i.e. spread of data) in each of our groups is quite different (96.63 for WT and 143.94 for KO). 
The widths of the base of our histograms are also different, though not by a very large amount. 
Both of these suggest a Welch's correction may be needed.")
```



## Blood vessel formation

In blood plasma cancer, there is an increase in blood vessel formation in the bone marrow. A stem cell transplant can be used as a treatment for blood plasma cancer. The bone marrow micro vessel density was measured before and after treatment for 7 patients with blood plasma cancer.

We are interested in seeing whether there is a decrease in the bone marrow micro vessel density after treatment with a stem cell transplant. We will use a paired two-sample t-test to compare the before and after bone marrow micro vessel densities. 

The data are contained in the file **`bloodplasmacancer2.csv`**. These data can be analysed online at [http://bioinformatics.cruk.cam.ac.uk/stats/TwoSampleTest/](http://bioinformatics.cruk.cam.ac.uk/stats/TwoSampleTest/)

a) What are your null and alternative hypotheses?

```{r}
cat("Null hypothesis: the bone marrow micro vessel density after treatment is greater 
than or equal to the bone marrow micro vessel density before treatment. 

Alternative hypothesis: the bone marrow micro vessel density after treatment 
is less than the bone marrow micro vessel density before treatment.")

```

Import the data, making sure that ***`1st column is a factor`*** is *not* ticked. Now choose whether you will be performing a paired test or not. 


b) Plot a histogram of the differences. Do the data look normally distributed? Is the paired t –test appropriate?

```{r results='hide'}
myfile <- "Practical/bloodplasmacancer2.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
data <- reshape2::melt(data)
colnames(data) <- c('variable','value')
library(ggplot2)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
newDf <- do.call(cbind,split(data$value,data$variable))
Diff <- data.frame(Difference=newDf[,1] - newDf[,2])
p2 <- ggplot(Diff,aes(x=Difference)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + stat_function(fun=dnorm, color='red', arg=list(mean=mean(Diff$Difference), sd=sd(Diff$Difference)))
p <- gridExtra::grid.arrange(p,p2)
p

```



```{r}
cat("From this histogram it is difficult to tell whether the differences between 
  the densities before and after treatment are normally distributed. In situations 
  like this, we may need to draw on the experience of similar sets of measurements. ")
```


c) We are interested in seeing whether there is a decrease in the bone marrow micro vessel density after treatment with a stem cell transplant. Is this a one-tailed or two-tailed test?

```{r}
cat("One-tailed as we are only interested in a decrease. 
Usually a two-sided test is preferred unless there is a strong argument 
for a one-sided test. In this case our treatment is only considered to be effective 
if we see a reduction in the bone marrow micro vessel density after treatment. 
Observing an increase in bone marrow density after treatment would lead to the same 
action/conclusion as if no difference had been observed – the treatment might be 
dropped from the research programme (but bear in mind here, 
the sample size is small and so only large differences may be detected).")
```

d) Compare the durations before and after values. Ensure you select the one- or two-tailed test as appropriate. What is the mean difference? What is your value of t? What is the p-value? How do you interpret the p-value? 

```{r}
alternative <- 'greater'
paired <- TRUE
var.equal <-FALSE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```

```{r}
cat("Under the null hypothesis, the probability of observing a t-statistic as extreme as 1.84, is 0.06, 
slightly greater than 0.05, our nominal significance level. Our result is borderline. 
There is insufficient evidence to reject the null hypothesis. 
Therefore, we might conclude that there is an association of a decrease in bone marrow micro vessel 
density after treatment with bone marrow transplant. It is important to note the small sample size here. 
Studying just 7 patients means we will only be able to detect large differences.")
```

## Birth-weight of twins

Dr D. R. Peterson of the Department of Epidemiology, University of Washington, collected the data found in file **`twins.csv`**.  It consists of the birth-weights of each of 20 dizygous twins.  The hypothesis to be tested is that the SIDS child of each pair has a lower birth-weight.  

a. Construct the null and alternative hypothesises


b. Decide on the level of significance to be used and whether the test should be one-sided or two-sided.


c. Carry out both the sign and Wilcoxon signed rank tests on the data.  Do both tests draw the same conclusion about the data?  Which test is the most appropriate?

## Vitamin D levels

The file **`vitd.csv`** contains data on vitamin D levels for subjects with fibrosis.

a. Use the Mann-Whitney U and t-tests to compare vitamin D levels between those with and without fibrosis.  Interpret the results from both tests. Do both tests reach the same conclusion?

b. Which test is the more appropriate?

# Tests for categorical variables

## Nucleotide frequency 

 In **Table 1**, we have the frequencies of the four nucleotides in two sequences. We are interested in comparing the nucleotide proportions of the two sequences.


```{r results='asis' ,eval=TRUE}
library(xtable)
df <-  matrix(c(273,233,236,258,281,246,244,229), 2, 4, byrow=TRUE)
colnames(df) <- c("A","C","G","T")
df <- data.frame(df)
df$Total <- rowSums(df)

df <- rbind(df, colSums(df))
rownames(df) <- c("Sequence 1", "Sequence 2","Total")
print(xtable(df,label="Table 1",caption="Nucleotide frequencies for two sequences"),comment=FALSE)
```


a) What are your null and alternative hypotheses?

```{r}
cat("Null hypothesis. there is no association between sequence number and nucleotide.

Alternative hypothesis. there is an association between sequence number and nucleotide.")

```

We can analyse these data online in the [Shiny app](http://bioinformatics.cruk.cam.ac.uk/stats/contingency-table/), by modifying the contents of the ***Enter your data as a table*** box. Columns need to be separated by a '-' character, and rows by a '|'. You can check that you have entered the data correctly by looking at ***The data*** tab. You do not need to calculate row or column totals.


Note that you do not need to enter the totals.

What is your value of your Chi-squared statistic and its corresponding p-value? How do you interpret the result?

```{r}
.Table <- matrix(c(273,233,236,258,281,246,244,229), 2, 4, byrow=TRUE)

rownames(.Table) <- c('1', '2')

colnames(.Table) <- c('1', '2', '3', '4')

.Test <- chisq.test(.Table, correct=FALSE)

.Test
```

```{r}
cat("Under the null hypothesis, the probability of observing a Chi-squared statistic 
as extreme as 2.3286, is 0.5071. There is no evidence to reject the null hypothesis. 
Therefore, there is no evidence of an association between sequence number and nucleotide.")

```


## Disease association
**Table 2** gives the frequencies of wild-type and knock-out mice developing a disease thought to be associated to the absence of the knock-out gene. 

```{r results='asis' ,eval=TRUE}
library(xtable)
df <-  matrix(c(1,7,9,3), 2, 2, byrow=TRUE)
colnames(df) <- c("WT","KO")
df <- data.frame(df)
df$Total <- rowSums(df)

df <- rbind(df, colSums(df))
rownames(df) <- c("Disease", "No Disease","Total")
print(xtable(df,label="Table 2",caption="Frequencies of wild-type and knock-out mice developing disease"),comment=FALSE)
```


a) What are your null and alternative hypotheses?

```{r}
cat("Null hypothesis: there is no association between mouse type and disease X

Alternative hypothesis: there is an association between mouse type and disease X")

```

b) What are your expected frequencies? 

```{r}
.Table <- matrix(c(1,7,9,3), 2, 2, byrow=TRUE)
rownames(.Table) <- c('Disease', 'No Disease')
colnames(.Table) <- c('WT', 'KO')
.Test <- chisq.test(.Table, correct=FALSE)
.Test$expected
```


Enter the data into the [Shiny app](http://bioinformatics.cruk.cam.ac.uk/stats/contingency-table/) as before

c) Select the **Fisher's exact test** option to compare the proportion of mice in each group that developed the disease. What is your p-value? How do you interpret the result?

```{r}
.Table <- matrix(c(1,7,9,3), 2, 2, byrow=TRUE)
rownames(.Table) <- c('Disease', 'No Disease')
colnames(.Table) <- c('WT', 'KO')
.Test <- chisq.test(.Table, correct=FALSE)
.Test$expected
ft<- fisher.test(.Table)
ft
```


```{r}
cat("p = 0.02. Under the null hypothesis, there is a small probability (p=0.02<0.05) 
of observing such an extreme distribution of the mice given the observed row and column totals. 
There is evidence to reject the null hypothesis in favour of the alternative hypothesis. 
There is evidence of an association between mouse type and disease X.")
```

# Choosing a test 

In this section, we introduce several datasets and will invite you in groups to select a dataset and discuss what methods / tests you would use to analyse those data.

```{r}
library(UsingR)
library(HistData)
library(ggplot2)
library(dplyr)
library(tidyr)
library(breastCancerNKI)
library(Biobase)
```




## Dataset 1: Barley yields `data1.csv`

In this data set named immer, the barley yield in years 1931 and 1932 of the same field are recorded. 

* Is there evidence for a difference in yield between 1931 and 1932?*

```{r eval=FALSE,echo=FALSE}
#http://www.r-tutor.com/elementary-statistics/non-parametric-methods/wilcoxon-signed-rank-test
library(MASS)
data(immer)
data <- immer[,c("Y1","Y2")]
wilcox.test(immer$Y1, immer$Y2, paired=TRUE) 
write.csv(data, file="mystery-data/data1.csv",quote=FALSE,row.names=FALSE)
```

```{r}
myfile <- "data1.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
p
alternative <- 'two.sided'
paired <- FALSE
var.equal <-FALSE
wilcox.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```


## Dataset 2 `data2.csv`

In the history of data visualization, Florence Nightingale is best remembered for her role as a social activist and her view that statistical data, presented in charts and diagrams, could be used as powerful arguments for medical reform.

After witnessing deplorable sanitary conditions in the Crimea, she wrote several influential texts (Nightingale, 1858, 1859), including polar-area graphs (sometimes called "Coxcombs" or rose diagrams), showing the number of deaths in the Crimean from battle compared to disease or preventable causes that could be reduced by better battlefield nursing care.

Her Diagram of the Causes of Mortality in the Army in the East showed that most of the British soldiers who died during the Crimean War died of sickness rather than of wounds or other causes. It also showed that the death rate was higher in the first year of the war, before a Sanitary Commissioners arrived in March 1855 to improve hygiene in the camps and hospitals.

*Do the data support the claim that deaths due to avoidable causes decreased after a change in regime?*

```{r}
setwd("mystery-data/")
```



```{r eval=FALSE,echo=FALSE}

data("Nightingale")

require(reshape)
Night<- Nightingale[,c(1,8:10)]
melted <- melt(Night, "Date")
names(melted) <- c("Date", "Cause", "Deaths")
melted$Cause <- sub("\\.rate", "", melted$Cause)
melted$Regime <- ordered( rep(c(rep('Before', 12), rep('After', 12)), 3), 
                          levels=c('Before', 'After'))
Night <- melted

# subsets, to facilitate separate plotting
Night1 <- subset(Night, Date < as.Date("1855-04-01"))
Night2 <- subset(Night, Date >= as.Date("1855-04-01"))

# sort according to Deaths in decreasing order, so counts are not obscured [thx: Monique Graf]
Night1 <- Night1[order(Night1$Deaths, decreasing=TRUE),]
Night2 <- Night2[order(Night2$Deaths, decreasing=TRUE),]

# merge the two sorted files
Night <- rbind(Night1, Night2)


filter(Night, Cause=="Disease") %>% select(Regime,Deaths) %>% write.csv(file="mystery-data/data2.csv",quote=FALSE,row.names=FALSE)

filter(Night, Cause=="Disease") %>% select(Regime,Deaths) %>% ggplot(aes(x=Regime,y=Deaths)) + geom_boxplot()
Night.flt <- Night %>% filter(Cause=="Disease") %>% select(Regime,Deaths)


```


```{r}
myfile <- "data2.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
p
alternative <- 'two.sided'
paired <- FALSE
var.equal <-FALSE
wilcox.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```


## Dataset 3: Effect of bran on diet: `data3.csv`

The addition of bran to the diet has been reported to benefit patients with diverticulosis. Several different bran preparations are available, and a clinician wants to test the efficacy of two of them on patients, since favourable claims have been made for each. Among the consequences of administering bran that requires testing is the transit time through the alimentary canal. By random allocation the clinician selects two groups of patients aged 40-64 with diverticulosis of comparable severity. Sample 1 contains 15 patients who are given treatment A, and sample 2 contains 12 patients who are given treatment B.

*Does transit time differ in the two groups of patients taking these two preparations?*


```{r echo=FALSE,eval=FALSE}
##http://www.bmj.com/about-bmj/resources-readers/publications/statistics-square-one/7-t-tests

data <- data.frame(Group = c(rep("A", 15),rep("B", 12)), Time = c(44,51,52,55,60,62,66,68,69,71,71,76,82,91,108, 
                                                                  52,64,68,74,79,83,84,88,95,97,101,116))

write.csv(data, file="mystery-data/data3.csv",quote=FALSE,row.names=FALSE)
t.test(Time~Group,data,var.equal=TRUE)
```


```{r}
myfile <- "data3.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
p
alternative <- 'two.sided'
paired <- FALSE
var.equal <-FALSE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)
```


## Dataset4: Sleep Data `data4.csv`

Data which show the effect of two soporific drugs (increase in hours of sleep compared to control) on 10 patients.

*Does the drug have an effect on the amount of sleep?*

```{r echo=FALSE,eval=FALSE}
data(sleep)
sleep <- spread(sleep, group,extra)[,-1]
colnames(sleep) <- c("Group1","Group2")
write.csv(sleep, file="mystery-data/data4.csv",quote=FALSE,row.names=FALSE)

t.test(sleep[,1],sleep[,2],paired=TRUE)
```

```{r}
myfile <- "data4.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
data <- reshape2::melt(data)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
p
alternative <- 'two.sided'
paired <- FALSE
var.equal <-TRUE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```


## Dataset5: CD4 `data5.csv`

CD4 cells are carried in the blood as part of the human immune system. One of the effects of the HIV virus is that these cells die. The count of CD4 cells is used in determining the onset of full-blown AIDS in a patient. In this study of the effectiveness of a new anti-viral drug on HIV, 20 HIV-positive patients had their CD4 counts recorded and then were put on a course of treatment with this drug. After using the drug for one year, their CD4 counts were again recorded. 

*Do patients taking the drug have increased CD4 counts?*

```{r eval=FALSE,echo=FALSE}
data <- read.csv("http://vincentarelbundock.github.io/Rdatasets/csv/boot/cd4.csv")[,-1]
write.csv(data,file="mystery-data/data5.csv",quote=FALSE,row.names=FALSE)

boxplot(data)
t.test(data[,1],data[,2],paired=TRUE)
```

```{r}
myfile <- "data5.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
data <- reshape2::melt(data)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
df <- data.frame(data, Observation = rep(1:(nrow(data)/2),2))
p2 <- ggplot(df, aes(x = variable,y=value,col=as.factor(Observation),label=Observation,group=as.factor(Observation))) + geom_line() + geom_text() + coord_flip()
gridExtra::grid.arrange(p,p2)
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
newDf <- do.call(cbind,split(data$value,data$variable))
Diff <- data.frame(Difference=newDf[,1] - newDf[,2])
p2 <- ggplot(Diff,aes(x=Difference)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + stat_function(fun=dnorm, color='red', arg=list(mean=mean(Diff$Difference), sd=sd(Diff$Difference)))
#p <- gridExtra::grid.arrange(p,p2)
#p
alternative <- 'two.sided'
paired <- TRUE
var.equal <-TRUE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```


## Dataset6: Drink Driving `data6.csv`

Drunk driving is one of the main causes of car accidents. Interviews with drunk drivers who were involved in accidents and survived revealed that one of the main problems is that drivers do not realize that they are impaired, thinking “I only had 1-2 drinks … I am OK to drive.”

A sample of 100 drivers was chosen, and their reaction times in an obstacle course were measured before and after drinking two beers. The purpose of this study was to check whether drivers are impaired after drinking two beers

*Does drinking beer alter the reaction time of the driver?*

```{r echo=FALSE,eval=FALSE}

## http://bolt.mph.ufl.edu/6050-6052/unit-4b/module-13/paired-t-test/
# Study of 20 people initially. Let's fake the data to add a few more observations....

data <- read.csv("http://media.news.health.ufl.edu/misc/bolt/Intro/files/unit4/Mod13Data/beers.csv")

data2 <- data.frame(Before = rnorm(100, mean=mean(data[,1]),sd = sd(data[,1])),After = rnorm(100, mean=mean(data[,2]),sd=sd(data[,2])))

write.csv(data2,file="mystery-data/data6.csv",quote=FALSE,row.names=FALSE)



```

```{r}
myfile <- "data6.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',args=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
p
alternative <- 'two.sided'
paired <- FALSE
var.equal <-TRUE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```

## Dataset7: Weight gain in Rats `data7.csv`

The data arise from an experiment to study the gain in weight of rats fed on four different diets, distinguished by amount of protein (low and high) and by source of protein (beef and cereal).

*Does the high protein diet increase the weight of the rats?*

```{r eval=FALSE,echo=FALSE}
data <- read.csv("http://vincentarelbundock.github.io/Rdatasets/csv/HSAUR/weightgain.csv")[,c(3,4)] %>% arrange(type)
write.csv(data, file="mystery-data/data7.csv",quote=FALSE,row.names=FALSE)
boxplot(weightgain ~ type,data)
```

```{r}
myfile <- "data7.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
p
alternative <- 'two.sided'
paired <- FALSE
var.equal <-TRUE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```


## Dataset8: Colon cancer `data8.csv`

The tumor and the normal counter-part samples were prospectively collected from 9 patients who underwent surgical resection at the INT-MI. Neoplastic samples were obtained from the central area of the neoplasia, avoiding to select necrotic material or transition zones with healthy mucosa. Samples of colonic healthy mucosa were resected at least 20 centimeters far from the neoplasia and distant from the surgical resection margins. Tissue samples were stored in liquid nitrogen until RNA extraction. Total RNA was extracted from 10–20 mg of tumor samples and from 30–40 mg of normal samples.

The gene expression measurements for a paticular gene were extracted from the data. 

*Is this gene differentially-expressed between tumours and normals?*

```{r eval=FALSE,echo=FALSE}
library (GEOquery)
url <- "ftp://ftp.ncbi.nih.gov/pub/geo/DATA/SeriesMatrix/GSE33126/"
filenm <- "GSE33126_series_matrix.txt.gz"
if (!file.exists("GSE33126_series_matrix.txt.gz")) download.file (paste(url ,
filenm , sep = "" ) , destfile = filenm )
colonData <- getGEO (filename = filenm)

data <- data.frame(Tissue =  pData(colonData)$source_name_ch1,Expression = exprs(colonData)["ILMN_2366710",])

write.csv(data, file="mystery-data/data8.csv",quote=FALSE,row.names=FALSE)

```


```{r}
myfile <- "data8.csv"
sep <- ','
quote <- '"'
header <-  TRUE 
skip <-  0 
data <- read.csv(myfile, header=header, sep=sep, quote=quote,skip=skip)
colnames(data) <- c('variable','value')
head(data)
library(ggplot2)
p <- ggplot(data, aes(x = variable,y=value,fill=variable)) + geom_boxplot() + coord_flip()
df <- data.frame(data, Observation = rep(1:(nrow(data)/2),2))
p2 <- ggplot(df, aes(x = variable,y=value,col=as.factor(Observation),label=Observation,group=as.factor(Observation))) + geom_line() + geom_text() + coord_flip()
gridExtra::grid.arrange(p,p2)
p
lapply(split(data$value,data$variable),summary)
p <- ggplot(data, aes(x=value)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + facet_wrap(~variable) + stat_function(fun=dnorm,color='red',arg=list(mean=mean(data$value), sd=sd(data$value)))
var.test(value~variable,data=data)
newDf <- do.call(cbind,split(data$value,data$variable))
Diff <- data.frame(Difference=newDf[,1] - newDf[,2])
p2 <- ggplot(Diff,aes(x=Difference)) + geom_histogram(aes(y=..density..),colour='black',fill='white') + stat_function(fun=dnorm, color='red', arg=list(mean=mean(Diff$Difference), sd=sd(Diff$Difference)))
p <- gridExtra::grid.arrange(p,p2)
p
alternative <- 'two.sided'
paired <- TRUE
var.equal <-TRUE
t.test(value~variable,data=data,alternative=alternative,paired=paired,var.equal=var.equal)

```

```{r eval=FALSE,echo=FALSE}
zip(zipfile="mystery-data.zip",files=paste("mystery-data/",list.files("mystery-data/"),sep="/"))
```


